#!/usr/bin/env bash
# Copyright Martin VÃ¤th <martin@mvath.de>.
# This is part of the schedule project.

# Instead of bash also zsh and probably many other modern shells could be used.
# However, to avoid trouble with quoting, we require that printf knows
# the %q specifier which unfortunately is not guaranteed on POSIX shells.

# To avoid a possible race, we setup a task in the background which will wait:
tmux wait-for $$ &

# Now we open a new window in which we output the command and run schedule
# with a value of -a which will end our waiting task above.

tmux new-window -d "printf '%q ' schedule $(printf '%q ' "$@")
echo
schedule -a \"tmux wait-for -S $$\" $(printf '%q ' "$@")"

# Now we wait for the end of our above task: When this task finishes,
# we can be sure that the passed command has been queued.
# Without waiting, subsequent calls of schedule-tmux in some script
# cannot be guaranteed to queue the commands in the "correct" order.
wait
